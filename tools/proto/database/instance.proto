syntax = "proto3";

package database;

import "database/postgres.proto";
import "validate/validate.proto";
import "crossplane/deployment.proto";

option go_package = "github.com/stroppy-io/hatchet-workflow/internal/proto/database";

message Sidecar {
    message NodeExporter {
        bool enabled = 1;
        uint32 port = 2;  // default 9100
        repeated string collectors = 3;  // ["cpu", "memory", "disk"]
    }
    message Filebeat {
        bool enabled = 1;
        string logstash_host = 2;
        repeated string log_paths = 3;
    }
    message VectorAgent {
        bool enabled = 1;
        string sink_endpoint = 2;
        map<string, string> extra_config = 3;
    }
    oneof sidecar {
        option (validate.required) = true;
        NodeExporter node_exporter = 2;
        Filebeat filebeat = 4;
        VectorAgent vector = 5;
        Postgres.Sidecar.PostgresExporter postgres_exporter = 6;
        Postgres.Sidecar.PgbouncerExporter pgbouncer_exporter = 7;
    }
}

message Instance {
    crossplane.Hardware hardware = 1 [(validate.rules).message.required = true];
    oneof settings {
        option (validate.required) = true;
        Postgres.Instance postgres = 100;
    }
    repeated Sidecar sidecars = 2;
}
