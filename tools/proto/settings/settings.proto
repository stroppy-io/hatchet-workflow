syntax = "proto3";

package settings;

import "deployment/deployment.proto";
import "validate/validate.proto";

option go_package = "github.com/stroppy-io/hatchet-workflow/internal/proto/settings";


message HatchetConnection {
    string token = 1 [(validate.rules).string.min_len = 1];
    string host = 2 [(validate.rules).string.min_len = 1];
    uint32 port = 3 [(validate.rules).uint32 = {gte: 1, lte: 65535}];
}

message YandexCloudSettings {
    /*
        This structure used for create network (and subnet after) in cloud
        You must specify it to use cloud deployment
    */
    message NetworkSettings {
        string name = 1 [(validate.rules).string.min_len = 1];
        string external_id = 2 [(validate.rules).string.min_len = 1];
    }
    /*
        This structure used for create VMs in cloud
        You must specify it to use cloud deployment
    */
    message VmSettings {
        string base_image_id = 6 [(validate.rules).string.min_len = 1];
        // If vm_users is empty, default user will be created without SSH keys
        deployment.VmUser vm_user = 7;
        // Crate VMs with public IP always. May fail with quota of cloud resources
        bool enable_public_ips = 4;
        optional string platform_id = 8; // default is standard-v2
    }
    /*
        This structure used for create cloud provider resources
        You must specify it to use cloud deployment
    */
    message ProviderSettings {
        string token = 1 [(validate.rules).string.min_len = 1];
        string cloud_id = 10 [(validate.rules).string.min_len = 1];
        string folder_id = 2 [(validate.rules).string.min_len = 1];
        string zone = 3 [(validate.rules).string.min_len = 1];
    }
    ProviderSettings provider_settings = 4 [(validate.rules).message.required = true];
    NetworkSettings network_settings = 5 [(validate.rules).message.required = true];
    VmSettings vm_settings = 6 [(validate.rules).message.required = true];
}

message DockerSettings {
    string network_name = 1 [(validate.rules).string.min_len = 1];
    string edge_worker_image = 2 [(validate.rules).string.min_len = 1];
    // Base CIDR block for Docker bridge networks (e.g. "172.28.0.0/16").
    // If empty, defaults to 172.28.0.0/16.
    optional string network_cidr = 3;
    // Subnet prefix length carved from the base CIDR (e.g. 24 â†’ /24 subnets).
    // If zero, defaults to 24.
    optional uint32 network_prefix = 4;
}

message Settings {
    deployment.Target preferred_target = 1 [(validate.rules).enum.defined_only = true];
    HatchetConnection hatchet_connection = 2 [(validate.rules).message.required = true];
    DockerSettings docker = 3 [(validate.rules).message.required = true];
    optional YandexCloudSettings yandex_cloud = 4;
}

