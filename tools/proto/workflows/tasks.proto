syntax = "proto3";

package workflows;

import "stroppy/test.proto";
import "validate/validate.proto";
import "provision/provision.proto";
import "deployment/deployment.proto";

option go_package = "github.com/stroppy-io/hatchet-workflow/internal/proto/workflows";

/*
    Standalone tasks used in edge worker
*/
message Tasks {
    /*
        Setup database instance on edge worker
    */
    message StartDockerContainers {
        message Input {
            stroppy.TestRunContext context = 1 [(validate.rules).message.required = true];
            string compose_file_content = 2 [(validate.rules).string.min_len = 1];
            repeated provision.Container containers = 3 [(validate.rules).repeated.min_items = 1];
            /*
                Need to docker containers for IPAM.Config
            */
            deployment.Ip worker_internal_ip = 4 [(validate.rules).message.required = true];
            deployment.Cidr worker_internal_cidr = 5 [(validate.rules).message.required = true];
        }
        message Output {}
    }
    /*
        Install stroppy cli on edge worker
    */
    message InstallStroppy {
        message Input {
            stroppy.TestRunContext context = 1 [(validate.rules).message.required = true];
            stroppy.StroppyCli stroppy_cli = 2 [(validate.rules).message.required = true];
        }
        message Output {}
    }
    /*
        Run stroppy test on edge worker
    */
    message RunStroppy {
        message Input {
            stroppy.TestRunContext context = 1 [(validate.rules).message.required = true];
            stroppy.StroppyCli stroppy_cli_call = 2 [(validate.rules).message.required = true];
        }
        message Output {
            stroppy.TestResult result = 1 [(validate.rules).message.required = true];
        }
    }
}